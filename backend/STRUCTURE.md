# Backend Project Structure

This document describes the structure of the Solar Cell CMS backend repository.

## Directory Structure

```
backend/
├── src/                          # Source code
│   ├── server.ts                 # Express server entry point
│   ├── payload.config.ts         # Payload CMS configuration
│   ├── collections/              # Payload collections (to be added)
│   │   ├── Articles.ts           # Articles collection
│   │   ├── Services.ts           # Services collection
│   │   ├── Reviews.ts            # Reviews collection
│   │   ├── Leads.ts              # Leads collection
│   │   └── Media.ts              # Media collection
│   ├── access/                   # Access control functions (to be added)
│   │   └── isAdmin.ts            # Admin access control
│   ├── hooks/                    # Payload hooks (to be added)
│   │   └── slugify.ts            # Auto-generate slugs
│   ├── payload-types.ts          # Generated TypeScript types
│   └── generated-schema.graphql  # Generated GraphQL schema
├── dist/                         # Compiled JavaScript (generated by build)
├── media/                        # Uploaded media files (generated)
├── .env                          # Environment variables (not in git)
├── .env.example                  # Example environment variables
├── .gitignore                    # Git ignore rules
├── .eslintrc.js                  # ESLint configuration
├── nodemon.json                  # Nodemon configuration
├── package.json                  # Dependencies and scripts
├── tsconfig.json                 # TypeScript configuration
├── README.md                     # Project documentation
└── STRUCTURE.md                  # This file
```

## Key Files

### `src/server.ts`
Main Express server file that:
- Loads environment variables
- Configures CORS
- Initializes Payload CMS
- Sets up custom routes
- Starts the server

### `src/payload.config.ts`
Payload CMS configuration that defines:
- Admin panel settings
- Database connection
- Collections
- Editor configuration
- CORS and CSRF settings

### `src/collections/`
Directory for Payload collection definitions. Each collection file exports a `CollectionConfig` object that defines:
- Collection slug
- Fields schema
- Access control
- Hooks
- Admin UI configuration

### `src/access/`
Directory for access control functions used by collections to determine who can read/create/update/delete content.

### `src/hooks/`
Directory for Payload hooks that run before/after operations like:
- `beforeValidate`: Modify data before validation
- `afterChange`: Run logic after data changes
- `beforeChange`: Run logic before data changes

## Environment Variables

The following environment variables are required:

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URI` | MongoDB connection string | `mongodb://localhost:27017/solar-cell-cms` |
| `PAYLOAD_SECRET` | Secret key for Payload CMS | `your-secret-key-here` |
| `PORT` | Server port | `3001` |
| `FRONTEND_URL` | Frontend URL for CORS | `http://localhost:3000` |
| `NODE_ENV` | Node environment | `development` or `production` |

## Collections Overview

The backend will have the following collections:

### 1. Users
- Built-in Payload collection for authentication
- Fields: email, password, name
- Used for admin access

### 2. Media
- Handles file uploads (images, videos)
- Generates multiple image sizes
- Fields: filename, alt text, sizes

### 3. Articles
- Blog posts and articles
- Fields: title, header, slug, excerpt, content, featuredImage, publishedDate, status, SEO metadata
- Public read access, admin write access

### 4. Services
- Business services offered
- Fields: title, header, slug, description, featuredImage, gallery, status, SEO metadata
- Public read access, admin write access

### 5. Reviews
- Installation reviews and testimonials
- Fields: title, header, description, featuredImage, gallery, relatedService, status
- Public read access, admin write access
- Relationship with Services collection

### 6. Leads
- Contact form submissions
- Fields: fullName, phone, email, createdAt
- Public create access, admin read-only access
- No update or delete allowed

## API Endpoints

Once collections are added, the following API endpoints will be available:

### Authentication
- `POST /api/users/login` - Login
- `POST /api/users/logout` - Logout
- `GET /api/users/me` - Get current user

### Articles
- `GET /api/articles` - List all articles
- `GET /api/articles/:id` - Get single article
- `POST /api/articles` - Create article (admin only)
- `PATCH /api/articles/:id` - Update article (admin only)
- `DELETE /api/articles/:id` - Delete article (admin only)

### Services
- `GET /api/services` - List all services
- `GET /api/services/:id` - Get single service
- `POST /api/services` - Create service (admin only)
- `PATCH /api/services/:id` - Update service (admin only)
- `DELETE /api/services/:id` - Delete service (admin only)

### Reviews
- `GET /api/reviews` - List all reviews
- `GET /api/reviews/:id` - Get single review
- `POST /api/reviews` - Create review (admin only)
- `PATCH /api/reviews/:id` - Update review (admin only)
- `DELETE /api/reviews/:id` - Delete review (admin only)

### Leads
- `GET /api/leads` - List all leads (admin only)
- `GET /api/leads/:id` - Get single lead (admin only)
- `POST /api/leads` - Create lead (public)

### Media
- `GET /api/media` - List all media
- `GET /api/media/:id` - Get single media
- `POST /api/media` - Upload media (admin only)
- `DELETE /api/media/:id` - Delete media (admin only)

## Development Workflow

1. **Start MongoDB**: Ensure MongoDB is running
2. **Install dependencies**: `npm install`
3. **Configure environment**: Copy `.env.example` to `.env` and update values
4. **Run dev server**: `npm run dev`
5. **Access admin panel**: Navigate to `http://localhost:3001/admin`
6. **Create admin user**: Create your first admin user on first run
7. **Add collections**: Create collection files in `src/collections/`
8. **Update config**: Import collections in `src/payload.config.ts`
9. **Generate types**: Run `npm run generate:types` after adding collections

## Build and Deployment

### Build for Production
```bash
npm run build
```

This compiles TypeScript to JavaScript in the `dist/` directory.

### Run Production Build
```bash
npm run serve
```

### Deployment Checklist
- [ ] Set strong `PAYLOAD_SECRET` in production environment
- [ ] Use MongoDB Atlas or managed MongoDB service
- [ ] Configure production `FRONTEND_URL`
- [ ] Enable MongoDB authentication
- [ ] Set `NODE_ENV=production`
- [ ] Configure proper CORS origins
- [ ] Set up SSL/TLS certificates
- [ ] Configure backup strategy for MongoDB
- [ ] Set up monitoring and logging

## Next Steps

1. ✅ Basic project structure created
2. ✅ Add Media collection
3. ⏳ Add Articles collection
4. ⏳ Add Services collection
5. ⏳ Add Reviews collection
6. ⏳ Add Leads collection
7. ⏳ Add access control functions
8. ⏳ Add hooks for slug generation and validation
9. ⏳ Test all API endpoints
10. ⏳ Deploy to production

## Resources

- [Payload CMS Documentation](https://payloadcms.com/docs)
- [Payload Collections Guide](https://payloadcms.com/docs/configuration/collections)
- [Payload Access Control](https://payloadcms.com/docs/access-control/overview)
- [Payload Hooks](https://payloadcms.com/docs/hooks/overview)
